<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.6" />
<title>CCNx Synchronization Protocol</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>CCNx Synchronization Protocol</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>Sync is a CCNx facility that allows CCN components and applications to define Collections of named data in Repositories that are to be automatically kept in sync with identically defined Collections in neighboring Repositories. Sync is currently embedded in the Repository, and will be available separately in the future.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="SynchronizationProtocol">Synchronization Protocol</h2>
<div class="sectionbody">
<div class="paragraph"><p>Associated with each Repository is a Sync Agent that is responsible for keeping information about local Collections up to date as content is added to the Repository, for detecting and acquiring Content Objects in remote copies of the Collections that are not in the local Repository, and for responding to inquiries from remote Sync Agents for information about content in local Collections. The Synchronization Protocol is the dialog between Sync Agents for doing this.</p></div>
<div class="paragraph"><p>A Collection is a set of content whose names share a common prefix, and is defined by an application through use of a Create Slice request as described in <a href="CreateCollectionProtocol.html">CCNx Create Collection Protocol</a>. (The definition of a Collection is known as a <em>slice</em>.) Each Collection is synchronized independently of all others. When it detects a new Collection, the local Sync Agent builds a <em>sync tree</em> for the Collection that represents its content. As Content Objects are added to the Repository, their names are passed to the local Sync Agent, which updates relevant sync trees whenever it detects new content with matching names.</p></div>
<div class="paragraph"><p>The combined hash for each node in the tree is the arithmetic sum of the hashes of individual names in that node and of the combined hashes of all its child nodes (with carries). The combined hash for the sync tree is thus the sum of the hashes of all names in sync tree.</p></div>
<div class="paragraph"><p>The Sync Agent synchronizes a Collection with remote copies by periodically expressing a Root Advise Interest to neighboring nodes (i.e., reachable with scope = 2). The Root Advise contains the combined hash of the sync tree for the Collection. When a remote Sync Agent receives the Root Advise, it compares the root hash in the Interest with its own root hash. If they match, the Collections are in sync, and no response is sent.</p></div>
<div class="paragraph"><p>If the root hashes differ, the remote Sync Agent responds with its own root hash and the root node of its Collection. Using Node Fetch Interests, the local Sync Agent iteratively fetches all nodes having combined hashes that it does not recognize, and constructs a list of names that are not in the local sync tree. It then expresses a standard Interest for each name in the list, and stores returned content in the local Repository. (Note that, when possible, Node Fetches and Interests are pipelined for efficiency.)</p></div>
<div class="sect2">
<h3 id="_root_advise_interest">Root Advise Interest</h3>
<div class="paragraph"><p>A Root Advise Interest is used to determine if there are any names in a remote Collection that are not in the local Collection. For each local sync tree, the Sync Agent expresses a Root Advise Interest with a name that is, when expressed as a URI, of the form:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>ccnx:/&lt;topo&gt;/%C1.S.ra/&lt;slicehash&gt;/&lt;roothash&gt;</tt></pre>
</div></div>
<div class="paragraph"><p>where:</p></div>
<div class="ulist" id="RootAdviseComponents"><ul>
<li>
<p>
<strong><em>&lt;topo&gt;</em></strong> is the topological prefix for the sync tree.
</p>
</li>
<li>
<p>
<strong><tt>%C1.S.ra</tt></strong> is the command marker for the Root Advise Interest.
</p>
</li>
<li>
<p>
<strong><em>&lt;slicehash&gt;</em></strong> is a hash code that names the collection. Computing <strong><em>&lt;slicehash&gt;</em></strong> uses the CCN default hash algorithm to form a hash over the ccnb encoding of the configuration slice for the root.
</p>
</li>
<li>
<p>
<strong><em>&lt;roothash&gt;</em></strong> is the combined hash of the root node for the sync tree.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The Root Advise Interest is a request for a Repository to respond with the root node for a corresponding sync set that does not have a combined hash equal to <strong><em>&lt;roothash&gt;</em></strong>. The Interest may also contain an exclusion list for combined hashes already examined, so remote trees need only be examined once for missing content. Since updates to the sync tree should be seen within a reasonable time, a short freshness seconds for the response is used.</p></div>
<div class="paragraph"><p>A Repository with a corresponding sync set that does not have a combined hash of <strong><em>&lt;roothash&gt;</em></strong> should respond; otherwise, no response should be made.</p></div>
<div class="paragraph"><p>The response to a Root Advise Interest is, when expressed as a URI, of the form:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>ccnx:/&lt;topo&gt;/%C1.S.ra/&lt;slicehash&gt;/&lt;roothash&gt;/&lt;responsehash&gt;/&lt;version&gt;/&lt;segment&gt;</tt></pre>
</div></div>
<div class="paragraph"><p>where:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><em>&lt;topo&gt;</em></strong>, <strong><em>&lt;slicehash&gt;</em></strong>, and <strong><em>&lt;roothash&gt;</em></strong> are as <a href="#RootAdviseComponents">described above</a> and must be the same as for the request.
</p>
</li>
<li>
<p>
<strong><em>&lt;responsehash&gt;</em></strong> is the hash for the responder’s root.
</p>
</li>
<li>
<p>
<strong><em>&lt;version&gt;</em></strong> and <strong><em>&lt;segment&gt;</em></strong> are optional, and follow normal CCN naming practice. (See <a href="NameConventions.html">CCNx Basic Name Conventions</a>.)
</p>
</li>
</ul></div>
<div class="paragraph"><p>The Content Object in the response to the Root Advise Interest has the ccnb encoding of the root node of the remote sync tree, and is described below in <a href="#ContentObjects">Root Advise and Node Fetch Response Content</a>.</p></div>
<div class="paragraph"><p>As a Sync Agent examines nodes from the remote sync tree, it may encounter combined hash codes that are included in the local sync tree. In the above example, regardless of updates to the local sync tree, there is no need to receive remote roots with hashes of <strong><em>&lt;roothash&gt;</em></strong> or <strong><em>&lt;responsehash&gt;</em></strong> in response to subsequent Root Advise requests. The CCN Interest mechanism allows them to be excluded using an exclusion filter. This minimizes the likelihood of responses containing names that are already known to be included in the local tree.</p></div>
</div>
<div class="sect2">
<h3 id="_node_fetch_interest">Node Fetch Interest</h3>
<div class="paragraph"><p>When Root Hashes differ, the Sync Agent must fetch nodes of the remote sync tree that have combined hashes that differ from hashes in the local tree. To obtain these nodes, the Sync Agent uses a Node Fetch Interest that is, when expressed as a URI, of the form:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>ccnx:/&lt;topo&gt;/%C1.S.nf/&lt;slicehash&gt;/&lt;responsehash&gt;</tt></pre>
</div></div>
<div class="paragraph"><p>where:</p></div>
<div class="ulist" id="NodeFetchComponents"><ul>
<li>
<p>
<strong><em>&lt;topo&gt;</em></strong> and <strong><em>&lt;slicehash&gt;</em></strong> are as <a href="#RootAdviseComponents">described above</a> for Root Advise.
</p>
</li>
<li>
<p>
<strong><tt>%C1.S.nf</tt></strong> is the command marker for the Node Fetch Interest.
</p>
</li>
<li>
<p>
<strong><em>&lt;responsehash&gt;</em></strong> is the combined hash for a node that was returned in response to the Root Advise or a previous Node Fetch.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Note that the Root Advise refers to the node at the root of the sync tree, while the Node Fetch can fetch from any part of the sync tree.</p></div>
<div class="paragraph"><p>The response is, when expressed as a URI, of the form:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>ccnx:/&lt;topo&gt;/%C1.S.nf/&lt;slicehash&gt;/&lt;responsehash&gt;/&lt;version&gt;/&lt;segment&gt;</tt></pre>
</div></div>
<div class="paragraph"><p>where:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><em>&lt;topo&gt;</em></strong>, <strong><em>&lt;slicehash&gt;</em></strong>, and <strong><em>&lt;responsehash&gt;</em></strong> are as <a href="#NodeFetchComponents">described above</a> for Node Fetch, and must be the same as for the request.
</p>
</li>
<li>
<p>
<strong><em>&lt;version&gt;</em></strong> and <strong><em>&lt;segment&gt;</em></strong> are optional, and follow normal CCN naming practice. (See <a href="NameConventions.html">CCNx Basic Name Conventions</a>.)
</p>
</li>
</ul></div>
<div class="paragraph"><p>The content for the response is the ccnb encoding of the requested tree node, and is described below in <a href="#ContentObjects">Root Advise and Node Fetch Response Content</a>.</p></div>
<div class="paragraph"><p>As Content Objects are found in remote Repositories that are not present locally, they are fetched using normal CCN Interests (see <a href="InterestMessage.html">CCNx Interest Message</a>) and stored in the local Repository.</p></div>
</div>
<div class="sect2">
<h3 id="_example">Example</h3>
<div class="paragraph"><p>The Synchronization Protocol is illustrated in the following simple example.</p></div>
<div class="paragraph"><p>In this example, there are two applications, App-1 and App-2, running on separate nodes. Each node has a Repo/Sync Agent pair attached to the application. Assume that both applications wish to have identical contents for a shared collection.</p></div>
<div class="paragraph"><p><span class="image">
<img src="SyncProtocol.png" alt="SyncProtocol.png" />
</span></p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
At t1, application App-1 creates a Collection. We will assume that nothing in Repo-1 matches the Collection description, so the Collection is initially empty.
</p>
</li>
<li>
<p>
At t2, Sync-1 sends a Root Advise Interest. Even through the Collection is empty, a neighboring Repository might have a matching Collection that is not empty. In this example, there is no matching Collection, so there is no reply.
</p>
</li>
<li>
<p>
At t3, App-1 stores some content into Repo-1. This causes Sync-1 to notice that the empty sync tree is no longer valid, so it builds a new sync tree that describes the content.
</p>
</li>
<li>
<p>
At t4, the new sync tree has been built and is stable.
</p>
</li>
<li>
<p>
At t5 Sync-1 sends another Root Advise Interest. Since there is still no matching Collection, there is no response.
</p>
</li>
<li>
<p>
At t6, a second application, App-2 running on node-2, creates a matching Collection (using the identical description as App-1 created). The Collection is initially empty.
</p>
</li>
<li>
<p>
At t7, Sync-2 sends a Root Advise Interest.
</p>
</li>
<li>
<p>
At t8, Sync-1 sends a Root Advise reply because, while Sync-1 has a matching Collection, the root hash from Sync-2 does not match the root hash for Sync-1.
</p>
</li>
<li>
<p>
At t9, Sync-2 notices that its local sync tree root hash does not match the root hash that it received from Sync-1, so it compares the root node that it received from Sync-1 with its own, and finds the name of the Content Object in the Repo-1 Collection that it doesn&#8217;t have.
</p>
</li>
<li>
<p>
At t10, Sync-2 sends a content Interest since, in this simple example, there is only one Content Object to fetch.
</p>
</li>
<li>
<p>
At t11, Repo-1 replies with the Content Object.
</p>
</li>
<li>
<p>
At t12, all of the sync tree differences have been resolved, and a new sync tree has been built by Sync-2 and is stable. At this point, the Collections are identical at both Repo-1 and Repo-2.
</p>
</li>
<li>
<p>
At t13, the last event, Sync-2 sends a final Root Advise Interest, since there may be differences that have not yet been noticed between its local sync tree and some other remote sync trees. In this example, the two Repositories have the same contents for the Collection, and therefore the same root hash, so Sync-1 does not reply.
</p>
</li>
</ol></div>
<div class="paragraph"><p>From this point on, Sync-1 and/or Sync-2 will periodically send Root Advise Interests (with no responses) until the Collection is updated at one of the nodes, at which time the sequence from t6 and beyond is repeated.</p></div>
</div>
<div class="sect2">
<h3 id="ContentObjects">Root Advise and Node Fetch Response Content</h3>
<div class="paragraph"><p>The Content Object sent in response to a Root Advise or Node Fetch Interest contains a node of the sync tree associated with the specified Collection. For Root Advise, the Content Object is for the root node; for Node Fetch, it is for the requested node.</p></div>
<div class="paragraph"><p>The content of a sync tree node is shown below. The content of the Content Object is the ccnb encoding of this data.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>SyncNode ::= SyncVersion
             SyncNodeElements
             SyncContentHash
             Name
             Name
             SyncNodeKind
             SyncLeafCount
             SyncTreeDepth
             SyncByteCount</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_syncversion">SyncVersion</h3>
<div class="literalblock">
<div class="content">
<pre><tt>SyncVersion ::= nonNegativeInteger</tt></pre>
</div></div>
<div class="paragraph"><p><strong>SyncVersion</strong> specifies the version of the Slice definition. SYNC_VERSION and SLICE_VERSION are both defined in <tt>SyncMacros.h</tt> to have values of 20110614.</p></div>
</div>
<div class="sect2">
<h3 id="_syncnodeelements">SyncNodeElements</h3>
<div class="literalblock">
<div class="content">
<pre><tt>SyncNodeElements ::= (Name | SyncContentHash)*</tt></pre>
</div></div>
<div class="paragraph"><p><strong>SyncNodeElements</strong> specifies the elements in a sync tree node. An individual element can be the name of a Content Object as defined in the <a href="Name.html">CCNx Name Specification</a>, or the combined hash of a child node. There can be any mix of names and hashes in a sync tree node.</p></div>
</div>
<div class="sect2">
<h3 id="_synccontenthash">SyncContentHash</h3>
<div class="literalblock">
<div class="content">
<pre><tt>SyncContentHash ::= BLOB</tt></pre>
</div></div>
<div class="paragraph"><p><strong>SyncContentHash</strong> is the combined hash of a sync node and all of its descendants.</p></div>
</div>
<div class="sect2">
<h3 id="_name_name">Name, Name</h3>
<div class="paragraph"><p><strong>Name</strong>, <strong>Name</strong> are the minimum and maximum names respectively. The <em>minimum name</em> is the least name in the covered set, and the <em>maximum name</em> is the greatest name in the set, based on canonical ordering of CCN names. The <em>covered set</em> for a node is the union of the set of all names in the node with the covered sets of all descendant nodes.</p></div>
</div>
<div class="sect2">
<h3 id="_syncnodekind">SyncNodeKind</h3>
<div class="literalblock">
<div class="content">
<pre><tt>SyncNodeKind ::== nonNegativeInteger</tt></pre>
</div></div>
<div class="paragraph"><p><strong>SyncNodeKind</strong> is the <em>kind</em> of sync node, and is reserved for future expansion. It should be 0 to preserve future compatibility.</p></div>
</div>
<div class="sect2">
<h3 id="_syncleafcount">SyncLeafCount</h3>
<div class="literalblock">
<div class="content">
<pre><tt>SyncLeafCount ::= nonNegativeInteger</tt></pre>
</div></div>
<div class="paragraph"><p><strong>SyncLeafCount</strong> is the count of sync tree leaf nodes including the current node and all of its descendants.</p></div>
</div>
<div class="sect2">
<h3 id="_synctreedepth">SyncTreeDepth</h3>
<div class="literalblock">
<div class="content">
<pre><tt>SyncTreeDepth ::= nonNegativeInteger</tt></pre>
</div></div>
<div class="paragraph"><p><strong>SyncTreeDepth</strong> is the depth of the sync tree including the current node and all of its descendants.</p></div>
</div>
<div class="sect2">
<h3 id="_syncbytecount">SyncByteCount</h3>
<div class="literalblock">
<div class="content">
<pre><tt>SyncByteCount ::= nonNegativeInteger</tt></pre>
</div></div>
<div class="paragraph"><p><strong>SyncByteCount</strong> is the sum of the byte counts for the encodings for descendants of the current node.</p></div>
<div class="paragraph"><p><strong>SyncNodeKind</strong>, <strong>SyncContentHash</strong>, <strong>SyncLeafCount</strong>, <strong>SyncTreeDepth</strong>, and <strong>SyncByteCount</strong> are provided for efficiency, and can be derived by analyzing lower-level nodes of the sync tree.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2013-07-23 16:46:26 PDT
</div>
</div>
</body>
</html>
